<html><head>

<title>Hacking the world – Geo-locate incoming emails</title>


<script language="JavaScript1.2" src="/menu/menu.js"></script>
<link href="/menu/include_menu.css" rel="stylesheet" type="text/css" />


</head>
<body >
<table>
<tr border = 0>
<td width='12px' valign=top border=2 > &nbsp;</td>
<td colspan=2>
        <table cellpadding=0 cellspacing=0 width="100%" style="background-image: url(images/Header-Background.JPG)" >
            <tr>
                <td style="width: 250px">
                    <img src="images/Map-Title.jpg" />
                </td>
                <td valign=top>
                    <br />
                    <strong><span style="font-size: 12pt;  color: blue;"><span style="font-size: 16pt;
                        color: dimgray; font-family: Comic Sans MS">
                            Hacking the world &nbsp;- &nbsp;Geo-locate incoming emails
                        <br />
                    </span>
                        <br />
                        <hr />
                        <span style="font-size: 10pt; color: #000000; font-family: Verdana;">Author: <a href="/">Anup Shinde</a>.</span></span></strong></td>
            </tr>
        </table>
</td>
</tr>
<tr border = 0>
<td width='12px' valign=top border=2 > &nbsp;</td>
<td border = 0 valign=top style="font-size: 10pt; font-family: Verdana; letter-spacing: normal;">
    <br />
    <hr style="font-size: 10pt" />
    <br />
    What I am going to explain here is nothing new, but I would just like to share with
    you people a trick that has been very useful to me in past few years, especially
    for superficially scrutinizing cyber-strangers.
    <br />
    <br />
    <br />
    There is much software out there that will allow you to geo-locate the incoming
    mails and thereby making this task much easier to perform. For those who want to
    use this information only casually, the following is the simple procedure.
    <br />
    <br />
    <br />
    <strong>How it works?
        <br />
    </strong>
    <br />
    Geo-location is not a very complex process superficially and it consists of two
    basic steps.
    <br />
    <p>
    <br />
    </p>
    <ol>
        <li><strong>Find out the IP address</strong> (Internet protocol address) from where the mail originated.
            <br /> </li>
        <li><strong>Geo-locate the IP.</strong> -This is a technical process and if not difficult, it is a
    bit cumbersome to do manually, but developers have made free easy-to-use utilities
    for these.
    <br />
        </li>
    </ol>
    <strong>
        <br />
        So how do I start?
        <br />
    </strong>
    <br />
    First you need to get the headers of the mail. These headers are usually hidden
    by almost all the mail reading applications whether it is web-based or a desktop
    application.
    <br />
    <br />
    <br />
    <strong>How do I get the headers?
        <br />
    </strong>
    <br />
    Here I will be explaining these only for the web-based mail applications like Yahoo
    and GMail.
    <br />
    <br />
    <ul>
        <li>In GMail when you open the mail, select “More options” and click “Show original”&nbsp;<br /><br/>
        </li>
        <li>In Yahoo Mail, it has a link “Full Headers” at the bottom right of the mail. </li>
    </ul>
    <br />
    All mails have similar headers, except the way that they are shown. Here I would
    be taking an example of a mail received in GMail account. It shows the original
    mail in a simple text-only format
    <br />
    <br />
    <br />
    <br />
    <br />
    <strong>Searching the sender’s IP
        <br />
    </strong>
    <br />
    The following is the header as shown in the text format.
    <br />
    <br />
    <a href="images/Highlight-Headers.JPG" target="_blank"><img src="images/small-Highlight-Headers.JPG" style="font-size: 10pt"  /></a><br />
    <em>Fig 1 - Image highlighting the headers</em><br />
    <br />
    <br />
    The header is highlighted inside a green box. This header has many fields. Even
    I do not understand all of those. What is important to us is the “Received field”.
    Basically our first step is to find out the IP address of the sender. Therefore
    we just need to the see the Headers saying, “Received From”.
    <br />
    <br />
    <br />
    As you can see in the image, there are two such “received from” lines. Which one
    is correct? Actually both are correct. This mail was sent from a Yahoo mail account
    to a GMail account. It has been received two times. First the sender sent it to
    the Yahoo Mail Service and then it was sent from the Yahoo Mail service to the GMail
    service. Well, this is the same as the postal service applying their stamps at different
    places when the paper mails are routed to the destination.
    <br />
    <br />
    <br />
    But we are interested in the originating IP address only. And that is the IP address
    from where the yahoo service received the mail. Here it is “<strong>172.21.100.79</strong>”
    as underlined in the image.
    <br />
    <br />
    <br />
    Note: Take the IP from the last “Received From” header and use that IP for geo-location
    as explained in steps further. If that IP gives some kind of error while geo-locating
    use the IP from the second last “Received from” header and so on. But then any IP
    other than last one may not give completely correct results.
    <br />
    <br />
    <br />
    Display of mail headers may differ slightly in different services. A bit of search
    within the header can lead you to the correct IP address. (This again only if the
    application allows display of such data).
    <br />
    <br />
    <br />
    So we have completed the first step. Now we need to geo-locate the IP to its destination.
    <br />
    <br />
    <br />
    <strong>Geo-locating the IP </strong>
    <br />
    <br />
    Here, I would not be explaining the exact technical process for this. Instead I
    will be showing how to geo-locate the IP address
    <br />
    <br />
    I have been using two sites for the same.&nbsp;<br />
    <br />
    <ul>
        <li><a href="http://www.visualroute.com/" target=_blank>VisualRoute - http://www.visualroute.com/</a><br/><br/>
        </li>
        <li><a href="http://www.geoiptool.com/" target=_blank>GeoIPTool - http://www.geoiptool.com/</a>
            
        </li>
    </ul>
    <br />
    <br />
    First we will take up the latter one [<a href="http://www.geoiptool.com/" target=_blank>GeoIPTool - http://www.geoiptool.com/</a>]. This is easy
    to use and only for locating the IP address’s geographical location.
    <br />
    <br />
    Just input the
    IP address that you found into the “Host/IP” field in the form and click “View Info”.
    It will show you the geographical location where IP belongs. 
    <br />
    <br />
    Suppose I found the
    Sender’s IP address as “<strong>61.95.162.76</strong>”. The following shows me the information about
    the IP address.
    <br />
    <br />
    <a href="images/Geo-IP-Tool-Shot.JPG" target="_blank"><img src="images/small-Geo-IP-Tool-Shot.JPG" style="font-size: 10pt"  /></a><br />
    <em>Fig 2 - Image from GeoIPTool<br />
    </em>
    <br />
    <br />
    <br />
    <strong>
    Still not satisfied </strong>
    <br />
    <br />
    Well, GeoIPTool does not satisfy my requirements enough. Why? As shown in the image
    above, it gives me information like the IP address comes from the city Bangalore
    in Karnataka, India. But then Bangalore is a big city. Briefly speaking, it just
    does not help me too much.
    <br />
    <br />
    Therefore I turned to an old method of tracing it through “Visualware’s VisualRoute”.
    <br />
    <br />
    Currently, the website gives a live demo at <a href="http://visualroute.visualware.com/" target=_blank>
        <strong>
        VisualRoute- http://visualroute.visualware.com</strong></a><strong>/</strong><br />
    <br />
    <a href="images/VisualRoute-Shot.JPG" target="_blank"><img src="images/small-VisualRoute-Shot.JPG" style="font-size: 10pt"   /></a><br />
    <em>Fig 3 - Image from VisualRoute</em>
    <br />
    <br />
    <br />
    As the above image shows, the IP address is from “Infosys Technologies Ltd, Bangalore”.<br />
    <br />
    <br />
    But along with it, the tool also gives other not-so-important-for-us information
    like
    <br />
    <br />
    <br />
    <ul>
        <li>How the IP is reached? The complete path from the VisualRoute servers to that IP
            address.    <br />
</li>
        <li>&nbsp;It also mentions “Bharti Infotel Ltd”. It means that the company “Infosys,
            Bangalore” uses a connection line from “Bharti Infotel Ltd”. Well, this doesn’t
            mean that it is the only connection provider, but then strategically it is one of
            the 2 or may be at most 3 providers.     <br />
</li>
        <li>It mentions “Singtel Exchange”. Well, this is one of the major Internet line providers
            for India. But the entry here shows that “Bharti Infotel Ltd” mainly uses the “Singtel
            line” for the “WAN IP pool for Bangalore”.    <br />

        </li>
    </ul>
    The <em>“Snap”</em> button in the demo allows you to see the text-only report.<br />
    <br />
    <br />
    <br />
    <strong>Is the information, found in this way, always correct?
        <br />
    </strong>
    <br />
    Depends. It need not be always correct. But most of the time, I have found this
    information to be incorrect in the following cases.
    <br />
    <br />
    <ul>
        <li>Somebody knows this technique and intentionally sends the mail through entirely
            different connection. (I have not yet been able to trace such people through mail
            headers) <br /></li>
        <li>A mail is routed through many internal networks about which the external world has
            no information. Example. In a large organization, with offices in different parts
            of a country, they might be using a single server placed at the head office to send
            the mails. In that case you will only get the head-office location every time.<br /></li>
        <li>The mail providers like GMail hide this information from the receiver in some cases.
            <br />
        </li>
    </ul>
    <em><span style="text-decoration: underline">Warning:</span></em> The information
    about the geographical location for an IP is available from the Internet IP registration
    authorities (this is not what these authorities are actually called). If the registration
    information is incomplete or incorrect or hidden, this method will yield incorrect
    results.
    <br />
    <br />
    Well this ends the usage; those who are interested in knowing answers to somewhat
    technical stuff may read further.<br />
    <br />
    <br />
    <strong>How to change the outgoing information?
        <br />
    </strong>
    <br />
    Basically you cannot change the IP in the email headers until you use some kind
    of <strong>IP spoofing</strong>. But you can make use of an entirely different connection.
    How? Use the public proxies. When the mails are sent using public proxies, they
    originate from that public proxy IP address and therefore not possible to track
    directly (except when the heavy use is monitored and statistically analyzed conclusions
    are derived)&nbsp;<br />
    <br />
    <br />
    A concept called “<strong><em>Onion Routing</em></strong>” disallows such analysis
    attacks too. Though at some advanced networking level, you may like to see <a href="http://www.onion-router.net/"  target="_blank">http://www.onion-router.net/</a> <br />
    <br />
    <br />
    A not-so-well written article (by me) may allow you people to perform 
    <a href="/Articles/OnionRouting/index.html">“Onion Routing”</a><br />
    <br />
    <br />
    <br />
    <strong>What happens when mail is routed within the organization before being sent?
        <br />
        <br />
    </strong>Again taking the example of the big organization “Infosys”. This company
    has a development center at Pune, India. Any mails coming from its Pune development
    center are sent to the Internet through their Bangalore facility.
    <br />
    <br />
    <br />
    <a href="images/PunITP-Details.JPG" target="_blank"><img src="images/small-PunITP-Details.JPG" style="font-size: 10pt"   /></a><br />
    <em>Fig 4 - Image from PUNITP, Infosys</em><br />
    <br />
    <br />
    As seen from the above header, there are many “Received from” headers, but last
    two of them are unreachable from the Internet, because they are internal to the
    organization. So we use the third last IP, which resolved to Bangalore India. That
    is incorrect. The mail is from Pune, but still we cannot use this method to find
    out the real location of the sender. But from the naming conventions like “PUNITPMSG09.ad.infosys.com”,
    we can assume that the IP is from Pune. Assumptions may be wrong, but fortunately
    in this case it was correct.
    <br />
    <br />
    <br />
    <strong>How GMail is preventing geo-location? </strong>
    <br />
    <br />
    Not exactly preventing all such mails. But I found that mails sent from one GMail
    to another GMail account does not have the “Received From” headers. This makes it
    really difficult to trace the sender. Only GMail authorities would be capable of
    doing so.
    <br />
    <em>It is possible that I am wrong in this case. Correct me if so.
        <br />
    </em>
    <br />
    The image below shows how GMail blocks “Received from” headers:
    <br />
    <br />
    <br />
    <a href="images/GMail-To-GMail-Header.JPG" target="_blank"><img src="images/small-GMail-To-GMail-Header.JPG" style="font-size: 10pt"/></a><br />
    <em>Fig 5 - Image from GMail to GMail headers<br />
        <br />
        <br />
    </em>
    <hr style="font-size: 10pt" />
    <br />
    <em><strong>Note:
        <br />
    </strong>Any example used in this article has scrambled data at many places.
        <br />
        References to the organization "Infosys" are purely co-incidental.
        <br />
    </em>
    <br />
    <br />
    Please do not hesitate to ask queries/suggestions/issues/anything. Click <strong>
<a href="" onclick="javascript:window.open('/static/anup-contact.htm','','height=225,width=450');return false;"><span
        style="color: #3300ff"><span style="text-decoration: underline">here</span> </span></a>    
    </strong>for contact information.&nbsp;<br />
    <em>&nbsp;</em><br />
    <br />


</td>



<td border = 0  valign=top style="width: 3px">
    <script type="text/javascript"><!--
    google_ad_client = "pub-7512590957470103";
    google_ad_width = 160;
    google_ad_height = 600;
    google_ad_format = "160x600_as";
    google_ad_type = "text_image";
    google_ad_channel ="";
    google_color_border = "FDEFD2";
    google_color_bg = "FDEFD2";
    google_color_link = "0000CC";
    google_color_url = "008000";
    google_color_text = "000000";
    //--></script>
    <script type="text/javascript"
      src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
    </script>


</td>





</tr>
</table>

<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-665946-1";
urchinTracker();
</script>



</body>

</html>